# Go高级类型

Go的高级数据类型相当于自定义数据类型的模板或制作工具

## 数组

数组(array)是由若干相同类型的元素组成的序列

``` Go
var ipv4 [4]uint8 = [4]uint8{192, 168, 0, 1}
```

如果在函数体内, 可省略 `var` 关键字, 但赋值号必须由 `=` 变为 `:=`

数组长度也是数组类型的一部分, 只要数组长度不同, 即使是两个数组类型的元素类型相同, 他们也是不同的类型

与string类型一样, 一旦在声明中确定了数组类型的长度, 就无法改变它了

数组类型的零值一定是一个不包含任何元素的空数组, 一个类型的零值即为该类型变量未被显示赋值时的默认值, 以ipv4为例, 其所属类型的零值就是`[4]uint8{}`

在上面示例中, 等号右边的字面量表示该类型的一个值, 可以忽略在方括号中表示数组长度的正整数值:
``` Go
[...]uint8{192, 168, 0, 1}
```
方括号中的特殊标记 `...` 表示需要由Go编译器计算该值的元素数量并以此获得其长度

`索引表达式` 和 `切片表达式` 都可用于数组操作, 前者获取数组值中的一个元素, 后者获取一个元素类型与之相同的切片值

此外 `len` 和 `cap` 也都可以应用于数组值, 并都可以得到其长度

当需要详细规划程序所用的内存时, 数组类型非常有用, 使用数组值可以完全避免内存的二次分配操作, 因为它的长度是不可变的

## 切片

切片(slice)可以看做是一种对数组的包装形式, 它包装的数组称为该切片的底层数组. 反过来讲, 切片是针对其底层数组中某个连续片段的描述

``` Go
var ips = []string{"192.168.0.1", "192.168.0.2", "192.168.0.3"}
```

与数组不同, 切片的类型字面量(如`[]string`)并不携带长度信息. 切片的长度是会变的, 并且不是类型的一部分; 只要元素类型相同, 两个切片的类型就是相同的. 此外, 一个切片类型的零值总是 `nil`, 此零值的长度和容量都为0

切片值相当于对某个底层数组的引用, 其内部结构包含了3个元素:
- 指向底层数组中某个元素的指针
- 切片的长度
- 切片的容量

> 这里所说的容量是指: 从指针指向的那个元素到底层数组的最后一个元素的元素个数

切片值的容量意味着, 在不更换底层数组的前提下, 它的长度的最大值. 可通过 `cap` 函数和切片表达式, 在此前提下最大化一个切片值的长度: `ips[:cap(ips)]`

除 `len` 和 `cap`, 内建函数 `append` 也可应用于切片值: `ips = append(ips, "192.168.0.4")`
[append文档](https://golang.org/pkg/builtin/#append)

另一个值得提的内置函数是 `make`, 它用于初始化切片、字典或通道类型的值, 对于切片类型来说, 用 `make` 函数的好处就是可以用很短的代码初始化一个长度很大的值: `ips = make([]string, 100)`, 其中100个元素的值都是string的零值: 空字符串""

To learn more about slices, read the [Slices: usage and internals](https://blog.golang.org/go-slices-usage-and-internals) article.

## 字典

Go中字典类型是散列表(hash table)的一个实现, 其官方称为 `map`, 散列表是一个实现了关联数组的数据结构, 关联数组是用于表示键值对的无序集合的一种抽象数据类型. Go中称键值对为 `键-元素对`, 它把字典值中的每个键都看作与其对应的元素的索引, 这样的索引在同一个字典值中是唯一的

``` Go
var ipSwitches = map[string]bool{}
```

变量 `ipSwitches` 的键类型为 string, 元素类型为 bool, `map[string]bool{}` 表示了一个不包含任何元素的字典值

与切片类型一样, 字典类型也是一个引用类型, 字典类型的零值是 `nil`, 字典值的长度表示了其中的建-元素对的数量, 其零值的长度总是0

索引表达式可用于字典值中键-元素的添加和修改:
``` Go
ipSwitches["192.168.0.1"] = true  // 不存在该键, 添加元素值
ipSwitches["192.168.0.1"] = false // 已存在该键, 修改元素值
delete(ipSwitches, "192.168.0.1") // 删除元素, 无论是否存在键, 都会执行完毕
```
